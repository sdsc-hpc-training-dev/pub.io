<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>camera-traps - ICICLE Training Catalog</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/cards.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "camera-traps";
        var mkdocs_page_input_path = "camera-traps/README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> ICICLE Training Catalog
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">ICICLE Training Catalog</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">AI for CI-for-AI</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Harp</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../harp/">Index</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Cheetah</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../harp/cheetah/">Index</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Tests</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../harp/cheetah/tests/">Index</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../harp/cheetah/tests/build_summit/">How to build the dependencies on Summit</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../harp/cheetah/tests/build_theta/">How to build dependencies on Theta</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Examples</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >01 eulers number</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../harp/examples/01-eulers_number/">Estimating walltime to execute "calc_e.py" with given configurations for application: Calculating Euler's number</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Install script source</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../harp/install-script-source/">README</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Example</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../harp/install-script-source/example/">Local Install Script Example</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >iSpLib</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../iSpLib/">iSpLib - An Intelligent Sparse Library</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Software Architecture and Design</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../Base_ICICLE_Tapis_Software/">Base ICICLE Tapis Software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Event_Engine/">Event Engine</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Hello icicle auth clients</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../hello_icicle_auth_clients/">Hello ICICLE Authentication Clients</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Icicle rel 03 2023</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../hello_icicle_auth_clients/icicle_rel_03_2023/">Hello ICICLE Authentication Clients Software Release Notes:</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >CLI</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../hello_icicle_auth_clients/icicle_rel_03_2023/CLI/">Hello Icicle Authentication Clients Software Release Notes:</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" >ICICONSOLE</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" >TapisCL ICICLE</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Notebooks</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../hello_icicle_auth_clients/icicle_rel_03_2023/Notebooks/">Hello Icicle Authentication Clients Software Release Notes:</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Images</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../hello_icicle_auth_clients/images/readme/">Readme</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Tapis_Pods_Service/">Tapis Pods Service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../CI_Components_Catalog/">CI Components Catalog</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Animal Ecoloy</span></p>
              <ul>
                  <li class="toctree-l1 current"><a class="reference internal current" >Camera traps</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">camera-traps</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#architectual-overview">Architectual Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quick-start">Quick Start</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#application-configuration">Application Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#plugin-configuration">Plugin Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#internal-plugin-configuration">Internal Plugin Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#image_recv_plugin">image_recv_plugin</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#support-for-nvidia">Support for NVIDIA</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#support-for-arm-cpus">Support for ARM CPUs</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="RELEASE_NOTES/">Camera Traps Release Notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Custom install</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="custom_install/">Camera Traps Custom Installer</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >External plugins</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Image generating plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="external_plugins/image_generating_plugin/">Image Generating Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Image scoring plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="external_plugins/image_scoring_plugin/">Image Scoring Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Power measuring plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="external_plugins/power_measuring_plugin/">Power Measure Plugin</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Releases</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="releases/">Running Released Versions of Camera-Traps</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >0.3.1</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" >Integration test</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Src</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Python</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="src/python/">ctevents</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Digital Agriculture</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Camera traps</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">camera-traps</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#architectual-overview">Architectual Overview</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#quick-start">Quick Start</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#application-configuration">Application Configuration</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#plugin-configuration">Plugin Configuration</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#internal-plugin-configuration">Internal Plugin Configuration</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#image_recv_plugin">image_recv_plugin</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#support-for-nvidia">Support for NVIDIA</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#support-for-arm-cpus">Support for ARM CPUs</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="RELEASE_NOTES/">Camera Traps Release Notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Custom install</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="custom_install/">Camera Traps Custom Installer</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >External plugins</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Image generating plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="external_plugins/image_generating_plugin/">Image Generating Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Image scoring plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="external_plugins/image_scoring_plugin/">Image Scoring Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Power measuring plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="external_plugins/power_measuring_plugin/">Power Measure Plugin</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Releases</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="releases/">Running Released Versions of Camera-Traps</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >0.3.1</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" >Integration test</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Src</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Python</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="src/python/">ctevents</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Foodsheds</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >PPODLinkML</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../PPODLinkML/">PPOD_FSL - A LinkML Schema for UC Davis Food Systems Lab Applications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../PPODLinkML/LICENSE/">LICENSE</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../Smart_Foodsheds_Visual_Analytics_Dashboard/">Smart Foodsheds Visual Analytics Dashboard</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">ICICLE Training Catalog</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Digital Agriculture</li>
          <li class="breadcrumb-item">Camera traps</li>
      <li class="breadcrumb-item active">camera-traps</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="camera-traps">camera-traps</h1>
<p>The camera-traps application is both a simulator and an edge device application for classifying images, with the first deployment specializing in wildlife images.  The simulation environment will be implemented first and serve as a test bed for protocols and techniques that optimize storage, execution time, power and accuracy.  The ultimate goal is to deploy a version of this application on camera-trap devices in the wild.</p>
<h2 id="architectual-overview">Architectual Overview</h2>
<p>This application uses the <a href="https://github.com/tapis-project/event-engine">event-engine</a> library to implement its plugin architecture and event-driven communication.  The engine uses <a href="https://zeromq.org/">zmq</a> sockets to deliver events between senders and the subscribers interested in specific events.</p>
<p>The event-engine supports <em>internal</em> and <em>external</em> plugins.  Internal plugins are Rust plugins delivered with camera-traps and run in the camera-traps process.  External plugins are configured by camera-traps to run outside the camera-traps process and use a TCP port to send and receive events.  By using TCP, external plugins can be written in any language that supports the <a href="https://google.github.io/flatbuffers/">flatbuffers</a> wire protocol.</p>
<h2 id="quick-start">Quick Start</h2>
<p>To quickly start the application under <a href="https://docs.docker.com/get-docker/">Docker</a> using docker-compose, follow these steps:</p>
<ol>
<li>cd releases</li>
<li>Follow the directions in the README.md file</li>
</ol>
<h2 id="application-configuration">Application Configuration</h2>
<p>The camera-traps application requires configuration through environment variables or configuration files.  When launching the application from a <em>releases</em> subdirectory, the specific release's <em>config</em> directory will contain the default configuration files for running a short simulation test.</p>
<p>In general, plugins can also depend on their own environment variables and/or configuration files, and the same is true of test programs.  The <a href="https://github.com/tapis-project/camera-traps/tree/main/releases">releases</a> directory contains docker-compose files that use default configurations, which can serve as a template for production environment configuration.</p>
<table>
<thead>
<tr>
<th><strong>Target</strong></th>
<th><strong>Environment  Variable</strong></th>
<th><strong>Default  File</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>camera-traps application</td>
<td>TRAPS_CONFIG_FILE</td>
<td>~/traps.toml</td>
<td>Can be 1st command line parameter</td>
</tr>
<tr>
<td>image_gen_plugin</td>
<td></td>
<td>/input.json</td>
<td></td>
</tr>
<tr>
<td>image_store_plugin</td>
<td>TRAPS_IMAGE_STORE_FILE</td>
<td>~/traps-image-store.toml</td>
<td></td>
</tr>
<tr>
<td>power_measure_plugin</td>
<td>TRAPS_POWER_LOG_PATH</td>
<td>~/logs</td>
<td></td>
</tr>
<tr>
<td>oracle_monitor_plugin</td>
<td>TRAPS_ORACLE_OUTPUT_PATH</td>
<td>~/output</td>
<td></td>
</tr>
<tr>
<td>integration tests</td>
<td>TRAPS_INTEGRATION_CONFIG_FILE</td>
<td>~/traps-integration.toml</td>
<td></td>
</tr>
<tr>
<td>logger</td>
<td>TRAPS_LOG4RS_CONFIG_FILE</td>
<td>resources/log4rs.yml</td>
<td>Packaged with application</td>
</tr>
</tbody>
</table>
<p>The external python plugins run in their own processes and do not currently use environment variables.</p>
<p>The camera-traps application uses <a href="https://docs.rs/log4rs/latest/log4rs/">log4rs</a> as its log manager.  The log settings in <a href="https://github.com/tapis-project/camera-traps/blob/main/resources/log4rs.yml">resources/log4rs.yml</a> source code will be used unless overridden by assigning a log4rs.yml configuration filepath to the TRAPS_LOG4RS_CONFIG_FILE environment variable.  To maximize logging, set root level to <em>trace</em> in the effective log4rs.yml file.  Also, include the <em>observer_plugin</em> in the internal plugins list in the effective traps.toml file.</p>
<h2 id="plugin-configuration">Plugin Configuration</h2>
<p>Camera-traps uses a <a href="https://toml.io/en/">TOML</a> file to configure the internal and external plugins it loads.  Internal plugins are registered with the event-engine by simply specfying their names since their runtime characteristics are compiled into the application.  External plugins, on the other hand, require more detailed information in order to be registered.  Here is the example resources/traps.toml file content:</p>
<blockquote>
<p># This is the camera-traps application configuration file for versions 0.x.y of the application.<br>
# It assumes the use of containers and docker-compose as the deployment mechanism.<br>
title = "Camera-Traps Application Configuration v0.3.2"<br></p>
<p># The event engine's publish and subscribe port used to create the event_engine::App instance.<br>
publish_port = 5559
subscribe_port = 5560</p>
<p># An absolute path to the image directory is required but a file name prefix is optional.<br>
# If present the prefix is preprended to generated image file names.  This is the directory<br>
# into which the image_recv_plugin writes incoming images and the image_store_plugin may<br>
# delete images or output the scores for images.<br>
images_output_dir = "/root/camera-traps/images"<br>
# image_file_prefix = ""</p>
<p># The container for both internal and external plugins.  Internal plugins are written in rust<br>
# and compiled into the camera-traps application.  External plugins are usually written in<br>
# python but can be written in any language.  External plugins run in their own processes<br>
# and communicate via tcp or ipc.<br>
[plugins]
# Uncomment the internal plugins loaded when the camera-traps application starts.<br>
internal = [<br>
#    "image_gen_plugin",<br>
"image_recv_plugin",<br>
#    "image_score_plugin",<br>
"image_store_plugin",<br>
#    "observer_plugin"<br>
]</p>
<p># Configure each of the active internal plugins with the image processing action they should<br>
# take when new work is received.  If no action is specified for a plugin, its no-op action<br>
# is used by default.<br>
internal_actions = [<br>
"image_recv_write_file_action",<br>
"image_store_file_action"<br>
]</p>
<p># External plugins require more configuration information than internal plugins.<br>
# Each plugin must subscribe to PluginTerminateEvent.<br>
# <br>
# Note that each plugin must specify the external port to use in TWO PLACES: here as well as<br>
# in the docker-compose.yml file. If external_port changes here, it must ALSO be changed in the<br>
# docker-compose.yml file.<br>
[[plugins.external]]<br>
plugin_name = "ext_image_gen_plugin"<br>
id = "d3266646-41ec-11ed-a96f-5391348bab46"<br>
external_port = 6000<br>
subscriptions = [<br>
"PluginTerminateEvent"<br>
]<br>
[[plugins.external]]<br>
plugin_name = "ext_image_score_plugin"<br>
id = "d6e8e42a-41ec-11ed-a36f-a3dcc1cc761a"<br>
external_port = 6001<br>
subscriptions = [<br>
"ImageReceivedEvent",<br>
"PluginTerminateEvent"<br>
]<br>
[[plugins.external]]<br>
plugin_name = "ext_power_monitor_plugin"<br>
id = "4a0fca25-1935-472a-8674-58f22c3a32b3"<br>
external_port = 6010<br>
subscriptions = [<br>
"MonitorPowerStartEvent",<br>
"MonitorPowerStopEvent",<br>
"PluginTerminateEvent"<br>
]<br>
[[plugins.external]]<br>
plugin_name = "ext_power_control_plugin"<br>
id = "a59621f2-4db6-4892-bda1-59ecb7ff24ae"<br>
external_port = 6011<br>
subscriptions = [<br>
"PluginTerminateEvent"<br>
]<br>
[[plugins.external]]<br>
  plugin_name = "ext_oracle_monitor_plugin"<br>
  id = "6e153711-9823-4ee6-b608-58e2e801db51"<br>
 external_port = 6011<br>
subscriptions = [<br>
      "ImageScoredEvent",<br>
      "ImageStoredEvent",<br>
      "ImageDeletedEvent",<br>
      "PluginTerminateEvent"<br>
  ]<br></p>
</blockquote>
<p>Every plugin must subscribe to the PluginTerminateEvent, which upon receipt causes the plugin to stop.  Subscriptions are statically defined in internal plugin code and explicitly configured for external plugins.  External plugins also provide their predetermined UUIDs and external TCP ports.</p>
<p>Camera-traps looks for its configuration file using these methods in the order shown:</p>
<ol>
<li>The environment variable $TRAPS_CONFIG_FILE.</li>
<li>The first command line argument.</li>
<li>$HOME/traps.toml</li>
</ol>
<p>The first file it finds it uses.  If no configuration file is found the program aborts.</p>
<h3 id="internal-plugin-configuration">Internal Plugin Configuration</h3>
<p>The names listed in the <em>internal</em> list are the rust plugin file names.  These plugins run as separate threads in the camera-traps process.  The <em>internal_actions</em> list contains the file names that implement the different algorithms or actions associated with each internal plugin.</p>
<p>A naming convention is used to associate actions with their plugins:  An action name starts with its plugin name minus the trailing "plugin" part, followed by an action identifier part, and ends with "_action".  Each plugin has a no-op action that causes it to take no action other than, possibly, generating the next event in the pipeline.  For example, <em>image_gen_noop_action</em> is associated with the <em>image_gen_plugin</em>.</p>
<p>Internal plugins for which no corresponding action is specified are assigned their no-op plugin by default.</p>
<h3 id="image_recv_plugin">image_recv_plugin</h3>
<p>When <em>image_recv_write_file_action</em> is specifed, the <em>image_recv_plugin</em> uses the <em>image_dir</em> and <em>image_file_prefix</em> parameters to manage files.  The image_dir is the directory into which image files are placed.  Image file names are constructed from the information received in a NewImageEvent and have this format:</p>
<p><image_file_prefix><image_uuid>.<image_format>
The <em>image_uuid</em> and <em>image_format</em> are from the NewImageEvent.  The image_file_prefix can be the empty string and the image_format is always lowercased when used in the file name.</p>
<h2 id="support-for-nvidia">Support for NVIDIA</h2>
<p>The Image Scoring plugin can make use of NVIDIA GPUs to improve the performance of object detection and classification with some ML models. In order to make use of NVIDIA GPUs in the Camera Traps application, the following steps must be taken:</p>
<ol>
<li><em>Ensure the NVIDIA drivers are installed natively on the machine</em>. For example, on Ubuntu LTS, follow the instructions in Section 3.1 <a href="https://docs.nvidia.com/datacenter/tesla/tesla-installation-notes/index.html">here</a>. Be sure to reboot your machine after adding the keyring and installing the drivers. You can check to see if the drivers are installed properly and communicating with the hardware by running the following command: </li>
</ol>
<pre><code>nvidia-smi
</code></pre>
<ol>
<li><em>Install the NVIDIA Container Toolkit and configure the Docker Runtime</em>. See the instructions <a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/latest/install-guide.html">here</a>. Make sure to restart Docker after installing and configuring the toolkit. To check if the toolkit and Docker are installed and configured correctly, run the following:</li>
</ol>
<pre><code>docker run --gpus=all --rm -it ubuntu nvidia-smi
</code></pre>
<p>The output should be similar to the output from Step 1.</p>
<ol>
<li><em>Update the Camera Traps Compose File to Use GPUs</em>. Starting with release 0.3.3, the official Camera Traps releases docker-compose files include stanzas for making NVIDIA GPUs available to 
both the Image Scoring and Power Monitoring plugins. At this time, those stanzas must be 
uncommented; see the <a href="releases/0.3.3/docker-compose.yml">docker-compose.yml</a> file for more details.</li>
</ol>
<h2 id="support-for-arm-cpus">Support for ARM CPUs</h2>
<p><em>This section is a work in progress...</em></p>
<p>We are currently working on support for ARM CPUs, including support for Mac OSX M* hardware. </p>
<h1 id="developer-information">Developer Information</h1>
<h2 id="using-flatbuffers">Using Flatbuffers</h2>
<p>In-memory representations of events are translated into flatbuffer binary streams plus a leading two byte sequence that identifies the event type.  These statically defined byte sequences are specified in the <a href="https://github.com/tapis-project/camera-traps/blob/main/src/events.rs">events.rs</a> source file and repeated here for convenience.</p>
<p>// Each event is assigned a binary prefix that zqm uses to route incoming binary streams to all of the event's subscribers.<br>
pub const NEW_IMAGE_PREFIX:           [u8; 2] = [0x01, 0x00];<br>
pub const IMAGE_RECEIVED_PREFIX:      [u8; 2] = [0x02, 0x00];<br>
pub const IMAGE_SCORED_PREFIX:        [u8; 2] = [0x03, 0x00];<br>
pub const IMAGE_STORED_PREFIX:        [u8; 2] = [0x04, 0x00];<br>
pub const IMAGE_DELETED_PREFIX:       [u8; 2] = [0x05, 0x00];<br>
pub const PLUGIN_STARTED_PREFIX:      [u8; 2] = [0x10, 0x00];<br>
pub const PLUGIN_TERMINATING_PREFIX:  [u8; 2] = [0x11, 0x00];<br>
pub const PLUGIN_TERMINATE_PREFIX:    [u8; 2] = [0x12, 0x00];<br>
pub const MONITOR_POWER_START_PREFIX: [u8; 2] = [0x20, 0x00];<br>
pub const MONITOR_POWER_STOP_PREFIX:  [u8; 2] = [0x21, 0x00];<br></p>
<p>Each event sent or received begins with its two byte prefix followed by its serialized form as defined in the camera-traps flatbuffer definition file (<a href="https://github.com/tapis-project/camera-traps/blob/main/resources/events.fbs">events.fbs</a>).  The following section describes how to generate Rust source code from this definition file, a similar process can be used for any language supported by flatbuffers.</p>
<h2 id="updating-the-flatbuffers-messages">Updating the flatbuffers messages</h2>
<p>Flatbuffers info: https://google.github.io/flatbuffers/</p>
<p>The flatbuffers messages schema is defined in the <code>resources/events.fsb</code> file. To change the message formats do the following:</p>
<ol>
<li>Edit the <code>resources/events.fsb</code> file with your changes.</li>
<li>From the camera-traps directory, regenerate the <code>events_generated.rs</code> code with the command:</li>
</ol>
<pre><code>$ flatc --rust -o src resources/events.fbs
</code></pre>
<ol>
<li>(Optional) Add the following line to the top of the <code>src/events_generated.rs</code> file so that clippy warnings are suppressed:</li>
</ol>
<pre><code>// this line added to keep clippy happy
#![allow(clippy::all)]
</code></pre>
<h2 id="plugin-start-and-stop-protocol">Plugin Start and Stop Protocol</h2>
<p>Each plugin is required to conform to the following conventions:</p>
<ol>
<li>Register for the <em>PluginTerminateEvent</em>.</li>
<li>Send a <em>PluginStartedEvent</em> when it begins executing.</li>
<li>Send a <em>PluginTerminatingEvent</em> when it shuts down.</li>
</ol>
<p>The <em>PluginStartedEvent</em> advertises a plugin's name and uuid when it starts.  When a plugin receives a <em>PluginTerminateEvent</em>, it checks if the event's <em>target_plugin_name</em> matches its name or the wildcard name (<em>).  If either is true, then the plugin is expected to gracefully terminate.  The plugin is also expected to gracefully terminate if the event's </em>target_plugin_uuid<em> matches the plugin's uuid.  Part of plugin termination is for it to send a </em>PluginTerminatingEvent<em> to advertise that it's shutting down, whether in response to a </em>PluginTerminateEvent* or for any other reason.</p>
<h2 id="building-and-running-under-docker">Building and Running under Docker</h2>
<p>The instructions in this section assume <a href="https://docs.docker.com/get-docker/">Docker</a> (and docker-compose) are installed, as well as <a href="https://www.rust-lang.org/tools/install">Rust</a>, <a href="https://doc.rust-lang.org/cargo/getting-started/installation.html">cargo</a> and make.</p>
<p>From the top-level camera-traps directory, issue the following command to build the application's Docker images:</p>
<p>make build
See <a href="https://github.com/tapis-project/camera-traps/blob/main/Makefile">Makefile</a> for details.  From the <a href="https://github.com/tapis-project/camera-traps/tree/main/releases">releases</a> directory, navigate to the subdirectory of the specific release you want to run.  Issue the following command to run the application, including the external plugins for which it's configured:</p>
<p>docker-compose up
See <a href="https://github.com/tapis-project/camera-traps/blob/main/releases/0.3.2/docker-compose.yml">docker-compose.yaml</a> for details.  From the same release directory, issue the following command to stop the application:</p>
<p>docker-compose down</p>
<h2 id="building-and-running-the-rust-code">Building and Running the Rust Code</h2>
<p>If you're just interested in building the Rust, issue <em>cargo build</em> from the top-level camera-traps directory.  Alternatively, issue <em>cargo run</em> to build and run it.  External plugins are not started using this approach.  The internal plugins and their actions are configured using a <em>traps.toml</em> file, as discussed above.</p>
<h2 id="integration-testing">Integration Testing</h2>
<p>The camera-traps/tests directory contains <a href="https://github.com/tapis-project/camera-traps/blob/main/tests/integration_tests.rs">integration_tests.rs</a> program.  The integration test program runs as an external plugin configured via a <em>traps.toml</em> file as shown above.  See the top-level comments in the source code for details.</p>
<h2 id="plugin-development">Plugin Development</h2>
<p>This section addresses two questions:</p>
<ul>
<li>Why would I want to create a plugin?</li>
<li>What kind of plugin should I create?</li>
</ul>
<p>One would want to create their own plugin if they wanted to read or write events and perform some new action that isn't currently implemented.  If an existing plugin doesn't do what you want, you have the option of modifying that plugin or creating another plugin that acts on the same events and does what you need.</p>
<p>For example, the <em>image_gen_plugin</em> injects new images into the event stream, the <em>image_recv_plugin</em> writes new images to file, etc.  The <em>observer_plugin</em> is one that subscribes to all events and logs them for debugging purposes.  Most of the time we don't run the <em>observer_plugin</em>, but if we want extended logging we just include it to run in the traps.toml file.  In this case, having a separate plugin from which we can customize the logging of all events is more convenient then adding that logging capability to each existing plugin.</p>
<p>Another reason for introducing a new plugin would be to also service new events.  As the application evolves new capabilities might require new events.  This occurred as we develop support for power monitoring, which introduces 2 new events and a plugin to handle them.</p>
<p>When implementing a plugin the choice between internal and external is often technology driven.  Do we want to write a plugin in Rust and compile it into the application (internal) or do we want to write it in some other language and start it up in its own container (external)?  Considerations as to which approach to take include performance, resource usage, and availability of domain-specific libraries.</p>
<h2 id="release-procedures">Release Procedures</h2>
<p>When development on a new release begins a launch configuration is created in the new release's own <a href="https://github.com/tapis-project/camera-traps/tree/main/releases">releases</a> subdirectory.  When development completes and the final version of the release's images are pushed to docker hub, we tag those images with the release number and with the "latest" tag.</p>
<p>To be able to rebuild a release at anytime, we also tag the release's source code in github.  The tag is the same as the release version number.  Once confident that the tagged code is stable, release tags can be protected using github <a href="https://docs.github.com/en/repositories/managing-your-repositorys-settings-and-features/managing-repository-settings/configuring-tag-protection-rules">tag protection</a>.</p>
<h1 id="acknowledgements">Acknowledgements</h1>
<p><em>This work has been funded by grants from the National Science Foundation, including the ICICLE AI Institute (OAC 2112606) and Tapis (OAC 1931439).</em></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="src/python/" class="btn btn-neutral float-left" title="ctevents"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="RELEASE_NOTES/" class="btn btn-neutral float-right" title="Camera Traps Release Notes">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="src/python/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="RELEASE_NOTES/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../js/tooltips.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
