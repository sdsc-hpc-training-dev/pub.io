<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>Power Measure Plugin - ICICLE Training Catalog</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../../css/cards.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Power Measure Plugin";
        var mkdocs_page_input_path = "camera-traps/external_plugins/power_measuring_plugin/README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> ICICLE Training Catalog
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../..">ICICLE Training Catalog</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">AI for CI-for-AI</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >Harp</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../harp/">Index</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Cheetah</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../harp/cheetah/">Index</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Tests</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../harp/cheetah/tests/">Index</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../harp/cheetah/tests/build_summit/">How to build the dependencies on Summit</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../../../harp/cheetah/tests/build_theta/">How to build dependencies on Theta</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Examples</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >01 eulers number</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../harp/examples/01-eulers_number/">Estimating walltime to execute "calc_e.py" with given configurations for application: Calculating Euler's number</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Install script source</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../harp/install-script-source/">README</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Example</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../harp/install-script-source/example/">Local Install Script Example</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >iSpLib</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../iSpLib/">iSpLib - An Intelligent Sparse Library</a>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Software Architecture and Design</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Base_ICICLE_Tapis_Software/">Base ICICLE Tapis Software</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Event_Engine/">Event Engine</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >Hello icicle auth clients</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../hello_icicle_auth_clients/">Hello ICICLE Authentication Clients</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Icicle rel 03 2023</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../hello_icicle_auth_clients/icicle_rel_03_2023/">Hello ICICLE Authentication Clients Software Release Notes:</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >CLI</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../hello_icicle_auth_clients/icicle_rel_03_2023/CLI/">Hello Icicle Authentication Clients Software Release Notes:</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" >ICICONSOLE</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" >TapisCL ICICLE</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Notebooks</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../../hello_icicle_auth_clients/icicle_rel_03_2023/Notebooks/">Hello Icicle Authentication Clients Software Release Notes:</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Images</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../../hello_icicle_auth_clients/images/readme/">Readme</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Tapis_Pods_Service/">Tapis Pods Service</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../CI_Components_Catalog/">CI Components Catalog</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Animal Ecoloy</span></p>
              <ul>
                  <li class="toctree-l1 current"><a class="reference internal current" >Camera traps</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../">camera-traps</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../RELEASE_NOTES/">Camera Traps Release Notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Custom install</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../custom_install/">Camera Traps Custom Installer</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >External plugins</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" >Image generating plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../image_generating_plugin/">Image Generating Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Image scoring plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../image_scoring_plugin/">Image Scoring Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" >Power measuring plugin</a>
    <ul class="current">
                <li class="toctree-l4 current"><a class="reference internal current" href="#">Power Measure Plugin</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Releases</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../releases/">Running Released Versions of Camera-Traps</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >0.3.1</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" >Integration test</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Src</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Python</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../src/python/">ctevents</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Digital Agriculture</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" >Camera traps</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../../">camera-traps</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../RELEASE_NOTES/">Camera Traps Release Notes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Custom install</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../custom_install/">Camera Traps Custom Installer</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" >External plugins</a>
    <ul class="current">
                <li class="toctree-l3"><a class="reference internal" >Image generating plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../image_generating_plugin/">Image Generating Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" >Image scoring plugin</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../image_scoring_plugin/">Image Scoring Plugin</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3 current"><a class="reference internal current" >Power measuring plugin</a>
    <ul class="current">
                <li class="toctree-l4 current"><a class="reference internal current" href="#">Power Measure Plugin</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Releases</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../../releases/">Running Released Versions of Camera-Traps</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" >0.3.1</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" >Integration test</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" >Src</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" >Python</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../../src/python/">ctevents</a>
                </li>
    </ul>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Smart Foodsheds</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >PPODLinkML</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../PPODLinkML/">PPOD_FSL - A LinkML Schema for UC Davis Food Systems Lab Applications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../PPODLinkML/LICENSE/">LICENSE</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../Smart_Foodsheds_Visual_Analytics_Dashboard/">Smart Foodsheds Visual Analytics Dashboard</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">ICICLE Training Catalog</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Digital Agriculture</li>
          <li class="breadcrumb-item">Camera traps</li>
          <li class="breadcrumb-item">External plugins</li>
          <li class="breadcrumb-item">Power measuring plugin</li>
      <li class="breadcrumb-item active">Power Measure Plugin</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="power-measure-plugin">Power Measure Plugin</h1>
<hr />
<p>Power consumption in inferencing AI models is a critical consideration, particularly for edge devices. High power consumption can lead to reduced battery life, increased costs, and more frequent charging or battery replacement intervals. For AI models to be effectively integrated and operational in real-world scenarios, they need to be efficient, with minimal power demands. Efficient models enable faster computation, longer device uptime, and wider adoption in applications where constant power sources are unavailable. As AI continues to penetrate various sectors, optimizing power consumption during inferencing ensures the sustainable growth and usability of AI-driven solutions in our everyday lives.</p>
<p>Power measuring tools play a pivotal role in monitoring the power consumption of AI models during inference, especially in edge devices. As these models process data and make decisions in real time, understanding their power demands becomes crucial. By accurately gauging power usage, developers and system managers can dynamically adjust workloads, balance system resources, and optimize model parameters for energy efficiency. This real-time adjustment ensures that devices remain responsive, maximize battery life, and avoid potential overheating or other power-related issues. Furthermore, consistent power monitoring provides invaluable data for refining algorithms and hardware architectures. In essence, power measuring not only guarantees optimal performance during AI inference but also informs future advancements in AI hardware and software design, ensuring sustainable and efficient AI integration in various applications.</p>
<hr />
<h2 id="designs">Designs</h2>
<p>When inference AI models, we consider two important pieces of hardware that can consume most of the power on the device, i.e. CPU and GPU. CPU participates in data loading, pre-processing, post-processing, etc., while GPU will handle all the computation in AI models. Therefore, this plugin provides fine-grained monitoring of them.</p>
<table>
<thead>
<tr>
<th><strong>Hardware</strong></th>
<th><strong>Requirements</strong></th>
<th><strong>Backend API</strong></th>
<th><strong>Sample Rate (per second)</strong></th>
<th><strong>Notes</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>CPU</td>
<td>Intel RAPL interface</td>
<td>Scaphandre</td>
<td>2</td>
<td>Process-level monitoring</td>
</tr>
<tr>
<td>GPU</td>
<td>NVIDIA</td>
<td>NVML</td>
<td>2 (configurable)</td>
<td>On-chip power monitoring</td>
</tr>
</tbody>
</table>
<p>The plugin spawns two threads at launching. 
- Thread 0 will spin on the socket to check if new power-measuring events are coming, if so, it adds them to the event queue.
- Thread 1 will spin on the event queue, and read out events with the necessary information, e.g. monitoring type, duration, PIDs, start_time, etc.</p>
<p>The plugin uses the system-level process to directly run the backend APIs and capture the output. By default, CPU-level monitoring can be fine-grained at the individual processes, while GPU only logs the overall power on chip.</p>
<hr />
<h2 id="usage">Usage</h2>
<p>In other plugins where you want to measure power,</p>
<pre><code>from ctevents.ctevents import send_power_measure_fb_event
import os

pids = [os.getpid(), ]                                   # Could be any pids you want to measure
monitor_type = [0, ]                                     # 0 for CPU &amp; GPU, 1 for CPU, 2 for GPU  (TODO: 3 for DRAM)
monitor_duration = 10                                    # Seconds
send_power_measure_fb_event(socket, pids, monitor_type, monitor_duration)
</code></pre>
<p>Default log files will be saved under <code>~/logs</code>, and CPU and GPU logs will be separated. </p>
<p>We provide a test case in our plugin, set the environment <code>TRAPS_TEST_POWER_FUNCTION=1</code>, and the plugin will log its own power consumption for 10 seconds.</p>
<hr />
<h2 id="example-of-output">Example of output</h2>
<p><code>~/logs/CPU.json</code>:</p>
<pre><code>{&quot;2023-08-25 05:50:59&quot;: [8.369286, &quot;337263&quot;, &quot;python&quot;], &quot;2023-08-25 05:51:02&quot;: [8.153751, &quot;337263&quot;, &quot;python&quot;], &quot;2023-08-25 05:51:04&quot;: [7.726121, &quot;337263&quot;, &quot;python&quot;], &quot;2023-08-25 05:51:06&quot;: [8.300131, &quot;337263&quot;, &quot;python&quot;]}
</code></pre>
<p>The dict keys are the time stamps, for every process, the first element is the power in Watts, the second is the PID, and the third is the process name.</p>
<p><code>~/logs/GPU.json</code>:</p>
<pre><code>{&quot;2023-08-25 05:50:57&quot;: 48.57, &quot;2023-08-25 05:51:00&quot;: 47.49, &quot;2023-08-25 05:51:02&quot;: 53.4, &quot;2023-08-25 05:51:04&quot;: 47.5, &quot;2023-08-25 05:51:06&quot;: 49.96}
</code></pre>
<p>The dict keys are the time stamps, since NVIDIA does not support process-level monitoring, we only record the overall on-chip power(in Watts).</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../image_scoring_plugin/" class="btn btn-neutral float-left" title="Image Scoring Plugin"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../../releases/" class="btn btn-neutral float-right" title="Running Released Versions of Camera-Traps">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../image_scoring_plugin/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../../releases/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../js/tooltips.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
